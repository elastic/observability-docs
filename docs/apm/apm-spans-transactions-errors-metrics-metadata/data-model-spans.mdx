

import DataStreamsTracesDataStreams from '../../transclusion/apm/guide/data-streams/traces-data-streams.mdx'
import GeneratedSpans from '../../transclusion/apm/guide/data/elasticsearch/generated/spans.mdx'

<div id="data-model-spans"></div>

export let span_name_type_sheet = "https://docs.google.com/spreadsheets/d/1SmWeX5AeqUcayrArUauS_CxGgsjwRgMYH4ZY8yQsMhQ/edit#gid=644582948"

export let span_spec = "https://github.com/elastic/apm/blob/main/tests/agents/json-specs/span_types.json"

**Spans** contain information about the execution of a specific code path.
They measure from the start to the end of an activity,
and they can have a parent/child relationship with other spans.

Agents automatically instrument a variety of libraries to capture these spans from within your application,
but you can also use the Agent API for custom instrumentation of specific code paths.

Among other things, spans can contain:

* A `transaction.id` attribute that refers to its parent <DocLink id="serverlessObservabilityApmSpansTransactionsErrorsMetricsMetadata">transaction</DocLink>.
* A `parent.id` attribute that refers to its parent span or transaction.
* Its start time and duration.
* A `name`, `type`, `subtype`, and `action`â€”see the [span name/type alignment]({span_name_type_sheet})
    sheet for span name patterns and examples by ((apm-agent)).
    In addition, some APM agents test against a public [span type/subtype spec]({span_spec}).

* An optional `stack trace`. Stack traces consist of stack frames,
    which represent a function call on the call stack.
    They include attributes like function name, file name and path, line number, etc.

<DocCallOut title="Tip">
Most agents limit keyword fields, like `span.id`, to 1024 characters,
and non-keyword fields, like `span.start.us`, to 10,000 characters.
</DocCallOut>

<div id="data-model-dropped-spans"></div>

### Dropped spans

For performance reasons, APM agents can choose to sample or omit spans purposefully.
This can be useful in preventing edge cases, like long-running transactions with over 100 spans,
that would otherwise overload both the Agent and the APM Server.
When this occurs, the ((apm-app)) will display the number of spans dropped.

To configure the number of spans recorded per transaction, see the relevant Agent documentation:

* Go: [`ELASTIC_APM_TRANSACTION_MAX_SPANS`](((apm-go-ref-v))/configuration.html#config-transaction-max-spans)
* iOS: _Not yet supported_
* Java: [`transaction_max_spans`](((apm-java-ref-v))/config-core.html#config-transaction-max-spans)
* .NET: [`TransactionMaxSpans`](((apm-dotnet-ref-v))/config-core.html#config-transaction-max-spans)
* Node.js: [`transactionMaxSpans`](((apm-node-ref-v))/configuration.html#transaction-max-spans)
* PHP: [`transaction_max_spans`](https://www.elastic.co/guide/en/apm/agent/php/${variables['apm-php-branch']}/configuration-reference.html#config-transaction-max-spans)
* Python: [`transaction_max_spans`](((apm-py-ref-v))/configuration.html#config-transaction-max-spans)
* Ruby: [`transaction_max_spans`](((apm-ruby-ref-v))/configuration.html#config-transaction-max-spans)

<div id="data-model-missing-spans"></div>

### Missing spans

Agents stream spans to the APM Server separately from their transactions.
Because of this, unforeseen errors may cause spans to go missing.
Agents know how many spans a transaction should have;
if the number of expected spans does not equal the number of spans received by the APM Server,
the ((apm-app)) will calculate the difference and display a message.

### Data streams

Spans are stored with transactions in the following data streams:

<DataStreamsTracesDataStreams />

See <DocLink id="serverlessObservabilityApmDataStreams">Data streams</DocLink> to learn more.

### Example span document

This example shows what span documents can look like when indexed in ((es)).

<DocAccordion buttonContent="Expand ((es)) document">

<GeneratedSpans />

</DocAccordion>

