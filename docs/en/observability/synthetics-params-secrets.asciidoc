// lint disable params
[[synthetics-params-secrets]]
= Work with params and secrets

beta[]

Params allow you to use dynamically defined values, including sensitive information, in your
synthetic monitors. For example, you may want to test a production website with a particular
demo account whose password is only known to the team managing the synthetic monitors.

Param values can be declared by any of the following methods:

* In the _Global parameters_ tab of the <<synthetics-settings-global-parameters,Synthetics Settings page in {kib}>>.
* Declaring a default value for the parameter in a <<synthetics-dynamic-configs,configuration file>>.
* Passing the `--params` <<synthetics-cli-params,CLI argument>>. 

NOTE: If you are creating and managing synthetic monitors using
<<synthetics-get-started-project, projects>>, you can also use regular environment
variables via the standard node `process.env` global object.

The values in the configuration file are read in the following order:

. *Global parameters in {kib}*: The _Global parameters_ set in {kib} are read first.
. *Configuration file*: Then the _Global parameters_ are merged with any parameters defined in a configuration file.
  If a parameter is defined in both {kib} *and* a configuration file,
  the value in the configuration file will be used.
. *CLI*: Then the parameters defined in the configuration are merged with any parameters passed to the CLI `--params` argument.
  If a parameter is defined in a configuration file *and* using the CLI argument,
  the value defined using the CLI will be used.
  When running a script using the CLI, {kib}-defined _Global parameters_ have no impact
  on the test because it won't have access to {kib}.

[discrete]
[[synthetics-params-secrets-define]]
= Define params

There are three options for defining params to be used in synthetic monitors.

[discrete]
[[synthetics-params-secrets-kibana]]
== Global parameters in {kib}

In the {synthetics-app}:

. Go to *Settings*.
. Go to the *Global parameters* tab.
. Define parameters.

[role="screenshot"]
image::images/synthetics-params-secrets-kibana-define.png[Global parameters tab on the Synthetics Settings page in {kib}]

[discrete]
[[synthetics-dynamic-configs]]
== Project config file

Use a `synthetics.config.js` or `synthetics.config.ts` file to define variables your tests always need to be defined. 
This file should be placed in the root of your synthetics project. 

[source,js]
----
export default (env) => {
  let my_url = "http://localhost:8080";
  if (env === "production") {
    my_url = "https://elastic.github.io/synthetics-demo/"
  }
  return {
    params: {
      my_url,
    },
  };
};
----

The example above uses the `env` variable, which corresponds to the value of the `NODE_ENV` environment variable.

[discrete]
[[synthetics-cli-params]]
== CLI argument

To set parameters when running `elastic-synthetics` on the command line, use the `--params` or `-p` flag to the `elastic-synthetics` program. The provided map is merged over any existing variables defined in the `synthetics.config.{js,ts}` file.

For example, to override the `my_url` parameter, you would run:

[source,sh]
----
elastic-synthetics . --params '{"my_url": "http://localhost:8080"}'
----

[discrete]
[[synthetics-params-secrets-use]]
= Use params

You can use params in both lightweight and browser monitors created in
either a project or the Synthetics UI in {kib}.

[discrete]
[[synthetics-params-secrets-use-project]]
== In a project

For lightweight monitors in projects, wrap the name of the param in `${}` (for example, `${my_url}`).

[source,yaml]
----
- type: http
  name: Todos Lightweight
  id: todos-lightweight
  urls: ["${my_url}"]
  schedule: '@every 1m'
----

In browser monitors, parameters can be referenced via the `params` property available within the 
argument to a `journey`, `before`, `beforeAll`, `after`, or `afterAll` callback function.

Add `params.` before the name of the param (for example, `params.my_url`):

[source,js]
----
beforeAll(({params}) => {
  console.log(`Visiting ${params.my_url}`)
})

journey("My Journey", ({ page, params }) => {
  step('launch app', async () => {
    await page.goto(params.my_url) <1>
  })
})
----
<1> If you are using TypeScript, replace `params.my_url` with `params.my_url as string`.

[discrete]
[[synthetics-params-secrets-use-ui]]
== In the UI

To use a param in a lightweight monitor that is created in the Synthetics UI,
wrap the name of the param in `${}` (for example, `${my_url}`).

[role="screenshot"]
image::images/synthetics-params-secrets-kibana-use-lightweight.png[Use a param in a lightweight monitor created in the Synthetics UI]

To use a param in a browser monitor that is created in the Synthetics UI,
add `params.` before the name of the param (for example, `params.my_url`).

[role="screenshot"]
image::images/synthetics-params-secrets-kibana-use-browser.png[Use a param in a browser monitor created in the Synthetics UI]

[discrete]
[[synthetics-secrets-sensitive]]
= Working with secrets and sensitive values

Your synthetics scripts may require the use of passwords or other sensitive secrets that are not known until runtime.

[WARNING]
====
Because synthetics scripts have no limitations, a malicious script author could write a
synthetics journey that exfiltrates `params` and other data at runtime.
Do *not* to use truly sensitive passwords (for example, an admin password or a real credit card)
in *any* synthetics tools.
Instead, set up limited demo accounts, or fake credit cards with limited functionality.
====

Use environment variables to handle any values needing encryption at rest. 
The example below references a variable named `MY_URL` defined in the environment:

[source,js]
----
export default {
  params: {
    my_url: process.env.MY_URL
  }
};
----

// [source,yaml]
// ----
// - name: Todos
//   id: todos
//   type: browser
//   schedule: "@every 3m"
//   tags: todos-app
//   params:
//     url: ${MY_URL}
//   source:
//     inline:
//       script: |-
//       step("load homepage", async () => {
//         await page.goto(params.url);
//       });
//       step("hover over products menu", async () => {
//         await page.hover('css=[data-nav-item=products]');
//       });
// ----
