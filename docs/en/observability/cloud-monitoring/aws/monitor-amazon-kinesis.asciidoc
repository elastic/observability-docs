[[monitor-amazon-kinesis]]
= Monitor Amazon Kinesis data streams

++++
<titleabbrev>Monitor Amazon Kinesis</titleabbrev>
++++

Amazon Kinesis Data Streams is a serverless streaming data service that can
easily capture, process, and store data streams at any scale. Users can use
Amazon Kinesis Data Streams to collect and process large streams of data records
in real-time. 

Like most AWS services, Amazon Kinesis data streams and Amazon CloudWatch are
integrated so users can collect, view and analyze CloudWatch metrics for their
kinesis data streams, such as tracking shard usage and recording related
operations for each Kinesis data stream. Elastic Amazon Kinesis integration
collects metrics from Amazon CloudWatch using Elastic Agent. Users usually will
install Elastic Agent locally or on an EC2 instance and configure the
integration policy and add Amazon Kinesis integration.

Kinesis Data Streams by default sends stream-level (basic level) metrics to
CloudWatch every minute automatically. There is also shard-level data (enhanced
level) which is sent to CloudWatch every minute with an additional cost per
stream. To get this level of data, users must specifically enable it for each
stream using the AWS Kinesis `enable-enhanced-monitoring` API. For example

[source,shell]
----
aws kinesis enable-enhanced-monitoring --stream-name samplestream --shard-level-metrics ALL
----

Please see
https://docs.aws.amazon.com/kinesis/latest/APIReference/API_EnableEnhancedMonitoring.html[EnableEnhancedMonitoring]
documentation for more details.

[role="screenshot"]
image::images/kinesis-dashboard.png[Screenshot showing the Kinesis dashboard]

[discrete]

== Metrics to watch

.GetRecords 
|===
| Field | Description | Unit | Type

| `aws.kinesis.metrics.GetRecords.Bytes.avg`
| The average number of bytes retrieved from the Kinesis stream, measured over the specific time period. 
| Bytes
| double

| `aws.kinesis.metrics.GetRecords.IteratorAgeMilliseconds.avg`
| The average age of the last record in all GetRecords calls made against a Kinesis stream, measured over the specified time period. Age is the difference between the current time and when the last record of the GetRecords call was written to the stream.
| Milliseconds
| double

| `aws.kinesis.metrics.GetRecords.Latency.avg`
| The average time taken per GetRecords operation, measured over the specified time period.
| Milliseconds
| double

| `aws.kinesis.metrics.GetRecords.Records.avg`
| The average number of records retrieved from the shard, measured over the specified time period.
| Count
| double

| `aws.kinesis.metrics.GetRecords.Records.sum`
| The total number of records retrieved from the shard, measured over the specified time period.
| Count
| long

| `aws.kinesis.metrics.GetRecords.Success.avg`
| The average number of successful GetRecords operations per stream, measured over the specified time period.
| Count
| double

| `aws.kinesis.metrics.GetRecords.Success.sum`
| The total number of successful GetRecords operations per stream, measured over the specified time period.
| Count
| long

| `aws.kinesis.metrics.ReadProvisionedThroughputExceeded.avg`
| The average number of GetRecords called throttled for the stream over the specified time period.
| Count
| double

| `aws.kinesis.metrics.IteratorAgeMilliseconds.avg`
| The average age of the last record in all GetRecords calls made against a shard, measured over the specified time period. Age is the difference between the current time and when the last record of the GetRecords call was written to the stream.
| Milliseconds
| double
|===

.PutRecord
|===
| Field | Description | Unit | Type

| `aws.kinesis.metrics.PutRecord.Bytes.avg`
| The average number of bytes put to the Kinesis stream using the PutRecord operation over the specified time period.
| Bytes
| double

| `aws.kinesis.metrics.PutRecord.Latency.avg`
| The average time taken per PutRecord operation measured over the specified time period.
| Milliseconds
| double

| `aws.kinesis.metrics.PutRecord.Success.avg`
| The percentage of successful PutRecord operations per Kinesis stream, measured over the specified time period. 
| Count
| double
|===


.PutRecords
|===
| Field | Description | Unit |Type

| `aws.kinesis.metrics.PutRecords.Bytes.avg`
| The average number of bytes put to the Kinesis stream using the PutRecords operation over the specified time period.
| Bytes
| double

| `aws.kinesis.metrics.PutRecords.Latency.avg`
| The average time taken per PutRecords operation measured over the specified time period.
| Milliseconds
| double

| `aws.kinesis.metrics.PutRecords.Success.avg`
| The average number of PutRecords operations where at least one record succeeded, per Kinesis stream, measured over the specified time period. 
| Count
| double

| `aws.kinesis.metrics.PutRecords.TotalRecords.sum`
| The total number of records sent in a PutRecords operation per Kinesis data stream, measured over the specified time period.
| Count
| long

| `aws.kinesis.metrics.PutRecords.SuccessfulRecords.sum`
| The total number of successful records in a PutRecords operation per Kinesis data stream, measured over the specified time period.
| Count
| long

| `aws.kinesis.metrics.PutRecords.FailedRecords.sum`
| The total number of records rejected due to internal failures in a PutRecords operation per Kinesis data stream, measured over the specified time period.
| Count
| long

| `aws.kinesis.metrics.PutRecords.ThrottleRecords.sum`
| The total number of records rejected due to throttling in a PutRecords operation per Kinesis data stream, measured over the specified time period.
| Count
| long

| `aws.kinesis.metrics.WriteProvisionedThroughputExceeded.avg`
| The average number of records rejected due to the throttling for the stream over the specified time period. 
| Count
| double
|===

.Incoming and Outgoing
|===
| Field | Description | Unit | Type

| `aws.kinesis.metrics.IncomingBytes.avg`
| The average number of bytes successfully put to the Kinesis stream over the specified time period. This metric includes bytes from PutRecord and PutRecords operations.
| Bytes
| double

| `aws.kinesis.metrics.IncomingRecords.avg`
| The average number of records successfully put to the Kinesis stream over the specified time period. This metric includes record counts from PutRecord and PutRecords operations.
| Count
| double

| `aws.kinesis.metrics.OutgoingBytes.avg`
| The average number of bytes retrieved from the shard, measured over the specified time period. This metric represents the bytes returned in a single GetRecords operation or published in a single SubscribeToShard event for the shard in the specified time period.
| Bytes
| double

| `aws.kinesis.metrics.OutgoingRecords.avg`
| The average number of records retrieved from the shard, measured over the specified time period. This metric represents the records returned in a single GetRecords operation or published in a single SubscribeToShard event for the shard in the specified time period.
| Count
| double

| `aws.kinesis.metrics.OutgoingRecords.sum`
| The total number of records retrieved from the shard, measured over the specified time period.
| Count
| long
|===

.SubscribeToShard
|===
| Field | Description | Unit | Type

| `aws.kinesis.metrics.SubscribeToShard.RateExceeded.avg`
| This metric is emitted when a new subscription attempt fails because there already is an active subscription by the same consumer or if you exceed the number of calls per second allowed for this operation.
| Count
| long

| `aws.kinesis.metrics.SubscribeToShard.Success.avg`
| This metric records whether the SubscribeToShard subscription was successfully established. The subscription only lives for at most 5 minutes. Therefore the metric gets emitted at least once every 5 minutes.
| Count
| double

| `aws.kinesis.metrics.SubscribeToShardEvent.Bytes.avg`
| The average number of bytes received from the shard, measured over the specified time period.
| Bytes
| double

| `aws.kinesis.metrics.SubscribeToShardEvent.MillisBehindLatest.avg`
| The average number of records received from the shard, measured over the specified time period.
| Count
| double

| `aws.kinesis.metrics.SubscribeToShardEvent.Success.avg`
| This metric is emitted every time an event is published successfully. It is only emitted when thereâ€™s an active subscription.
| Count
| double

| `aws.kinesis.metrics.SubscribeToShardEvent.Records.sum`
| The total number of records received from the shard, measured over the specified time period.
| Count
| long
|===
