[[monitor-amazon-sqs]]
= Monitor Amazon Simple Queue Service (SQS)

++++
<titleabbrev>Monitor Amazon SQS</titleabbrev>
++++

The three main parts in a distributed messaging system are the software
components of your system, the queue (distributed on Amazon SQS) and the
messages in the queue.

Amazon Simple Queue Service (SQS) is a message queuing service that makes it
easy to decouple and scale microservices, distributed systems, and serverless
applications. 

AWS SQS and Amazon CloudWatch are integrated and therefore, users can collect,
view and analyze data. Metrics for Amazon SQS queues are automatically collected
and pushed to CloudWatch at one-minute intervals.

Users can view and analyze the queueâ€™s metrics from the Amazon SQS console, the
CloudWatch console, the AWS CLI or using the CloudWatch API.

After a message is received, it remains in the queue for consumers to ingest.
Amazon SQS provides a visibility timeout which is a period of time that prevents
other consumers from receiving and processing the message (default: 30s, min:
0s, max: 12h).

Amazon SQS does not automatically delete the messages in the queue and therefore
the consumer is responsible for the deletion of the message after consumption.

Elastic Amazon SQS integration collects metrics from Amazon CloudWatch using
{agent}.

The agent can be installed locally or on an EC2 instance and configure the integration policy to
include the Amazon SQS integration.

Amazon SQS is also integrated with AWS CloudTrail which is a service that can
capture API calls related to Amazon SQS queues as events. More information about
logging Amazon SQS API calls using AWS CloudTrail can be found here.

Amazon SQS integration comes with a {kib} dashboard out of the box:

[role="screenshot"]
image::images/sqs-dashboard.png[Screenshot showing the SQS overview dashboard]

[discrete]
== Metrics to watch

.messages
|===
| Field | Description | Unit | Type

| `aws.sqs.messages.delayed`
| The number of messages in the queue that are delayed and not available for reading immediately.
| Count
| long

| `aws.sqs.messages.not_visible`
| The number of messages that are in flight.
| Count
| long

| `aws.sqs.messages.visible`
| The number of messages available for retrieval from the queue.
| Count
| long

| `aws.sqs.messages.deleted`
| The number of messages deleted from the queue.
| Count
| long

| `aws.sqs.messages.received`
| The number of messages returned by calls to the ReceiveMessage action.
| Count
| long

| `aws.sqs.messages.sent`
| The number of messages added to a queue.
| Count
| long

| `aws.sqs.oldest_message_age.sec`
| The approximate age of the oldest non-deleted message in the queue.
| Milliseconds
| long

| `aws.sqs.sent_message_size.bytes`
| The size of messages added to a queue.
| Bytes
| long
|===

.queue
|===
| Field | Description | Unit | Type

| `aws.sqs.queue.name`
| SQS queue name
| Bytes
| keyword
|===
