[[monitor-azure-native]]
== Monitor Microsoft Azure with the native Azure integration

****
The Elastic Cloud native Azure integration allows you to deploy managed
instances of the {stack} directly in Azure, through the Azure integrated
marketplace. The integration includes native capabilities for consolidating
Azure logs and metrics in Elastic. For more information, refer to
https://www.elastic.co/guide/en/cloud/current/ec-azure-marketplace-native.html[Native Azure integration]
in the {ess} documentation.

**Using {agent} to monitor Azure?** Refer to <<monitor-azure-elastic-agent>>.

****

In this tutorial, you'll learn how to:

* Create an {es} resource in the Azure portal.
* Ingest Azure platform logs using the native integration.
* Ingest logs and metrics from your virtual machines.
* Visualize the logs and metrics in {kib}.

[discrete]
[[azure-create-resource]]
=== Step 1: Create an {es} resource in the Azure portal

IMPORTANT: The steps described here will not work if you have an active GCP or
AWS deployment in an {ecloud} account associated with your email address. To
resolve this problem, you can delete your GCP and AWS deployments in {ecloud},
or use a different Azure account.

Microsoft Azure allows you to find, deploy, and manage {es} from within the
Azure portal. The Microsoft Azure portal integration makes it faster and easier
for you to experience the value of Elastic in your Azure environment. Behind the
scenes, this process provisions a marketplace subscription with {ecloud}.

[discrete]
==== Create an {es} resource

. Log in to the https://portal.azure.com/[Azure portal].
+
[NOTE]
====
Ensure your Azure account is configured with **Owner** access on the subscription
you want to deploy {es}. To learn more about Azure
subscriptions, see the https://docs.microsoft.com/en-us/azure/cost-management-billing/manage/add-change-subscription-administrator#assign-a-subscription-administrator[Microsoft Azure documentation].
====

. In the search bar, enter *{es}* and then select **Elasticsearch (Elastic Cloud)**.

. Click **Create**.

. Enter the **Subscription**, **Resource group**, and the **Resource name**.
. Select a region and then click **Review + create**.
+
[NOTE]
====
Don't change any settings under Logs & metrics yet. We will cover logs and
infrastructure metrics later in this tutorial.
====
+
[role="screenshot"]
image::monitor-azure-native-create-elastic-resource.png[Screenshot of Elastic resource creation in Azure]

. To create the {es} deployment, click **Create**.
. After deployment is complete, click *Go to resource*. Here you can see and
configure your deployment details. To access the cluster, click *{kib}*.
+
[role="screenshot"]
image::monitor-azure-native-elastic-deployment.png[Screenshot of deployment details for Elastic resource in Azure]
// lint ignore observability
. Click **Accept** (if necessary) to grant permissions to use your Azure
account, then log in to {ecloud} using your Azure credentials as a single
sign-on.
. To see if there is any available data, click **Observability**.
There should be no data yet. Next, you'll ingest logs.

[discrete]
[[azure-ingest-logs-native-integration]]
=== Step 2: Ingest logs by using the native integration

To ingest Azure subscription and resource logs into Elastic, you use the
Microsoft Azure native integration.

. Go to your {es} resource page in Azure, and click
**Ingest logs and metrics from Azure Services**.

. Under **Logs**, select both checkboxes to collect subscription activity logs
and Azure resource logs. Click **Save**.
+
[role="screenshot"]
image:monitor-azure-native-elastic-config-logs-metrics.png[Screenshot of logs and metrics configuration for Elastic resource in Azure]
+
[NOTE]
====
This configuration can also be applied during the Elastic resource creation.
To make the concepts clearer, this tutorial separates the two steps.
====
+
[NOTE]
====
Native metrics collection is not fully supported yet and is discussed
later.
====

. In {kib}, under **{observability}**, click **Overview** until you see some
data. It might take a few minutes for data to appear in {kib}.
+
[role="screenshot"]
image::monitor-azure-native-kibana-observability-page-data.png[Screenshot of {kib} {observability} overview]
//REVIEWERS: Activity logs are not being collected.
. To access the {logs-app} and analyze your subscription and resource logs,
click **Show log stream** (or click **Stream** in the navigation pane).
+
[role="screenshot"]
image::monitor-azure-native-kibana-logs-app.png[{kib} {logs-app}]

[discrete]
[[azure-ingest-VM-logs-metrics]]
=== Step 3: Ingest logs and metrics from your virtual machines

. Go to your Elastic resource and click **Virtual machines**.
+
[role="screenshot"]
image:monitor-azure-elastic-deployment.png[Elastic resource]

. Select the VMs that you want to collect logs and metrics from, click
**Install Extension**, and then click **OK**.
+
[role="screenshot"]
image:monitor-azure-elastic-vms.png[Select VMs to collect logs and metrics from]

. Wait until it is installed and sending data (if the list
does not update, click **Refresh** ).
To see the logs from the VM in the {logs-app}, click  **Logs**.
+
[role="screenshot"]
image:monitor-azure-kibana-vms-logs.png[VMs logs in the {logs-app}]
+
To see the VM metrics dashboard, click **Infrastructure**.
+
[role="screenshot"]
image:monitor-azure-kibana-vms-metrics.png[VMs metrics dashboard]
+
[NOTE]
====
Both logs and metrics are filtered by the VM name that you selected.
To view the data for all the monitored VMs, delete the filter.
====
