[[upgrade-elastic-agent]]
[role="xpack"]
= Upgrade {stack} and {agent}

experimental[]

[discrete]
[[upgrade-fleet]]
== Upgrade to {fleet-server}

As part of the 7.13 release, we introduce <<fleet-server,{fleet-server}>>,
a mechanism to connect your {agent}s to {fleet}. 

[WARNING]
====
When you upgrade to 7.13 from 7.12 or lower, please note the following:

* All of your existing {agent}s will be automatically unenrolled from {fleet} and will stop sending data.
* Before you can add your {agent}s again to {fleet}, you must have {fleet-server} running.
* All of your policies will be migrated.
====

[discrete]
[[upgrade-your-stack]]
=== Step 1: Upgrade {stack}

Here’s what you need for upgrading your deployment type:

--
include::{tab-widgets}/upgrade-stack-widget.asciidoc[]
--

[discrete]
[[upgrade-fleet-server]]
=== Step 2: Upgrade to {fleet-server}

Here’s what you need to set up {fleet-server} for each deployment type:

--
include::{tab-widgets}/upgrade-fleet-widget.asciidoc[]
--


[discrete]
[[reenroll-agent]]
=== Step 3: Install and enroll {agent}s

IMPORTANT: Before installing and enrolling your {agent}s, make sure to uninstall
your previous {agent}s. See <<uninstall-elastic-agent>>.

{fleet-server} and {agent} running on {fleet-server} all run on the same version.
Any {agent} enrolling in {fleet-server} must match this version.

--
include::{observability-docs-root}/docs/en/ingest-management/getting-started.asciidoc[tag=agent-enroll]
--

[discrete]
[[upgrade-agent]]
== Upgrade {agent}

Starting with version 7.10, {fleet} provides upgrade capabilities. You can view
and select agents that are out of date, and trigger selected agents to download,
install, and run the new version.

This approach simplifies the process of keeping your agents up to date. It also
saves you time because you don’t need third-party tools or processes to
manage upgrades.

NOTE: The upgrade feature is not supported for upgrading DEB/RPM packages or
Docker images. 

To upgrade {agent} to a new version:

. In {fleet}, select **Agents**.

. Under **Agents**, click **Upgrade available** to see a list of agents
that you can upgrade.

. To upgrade a single agent, choose **Upgrade agent** from the **Actions** menu
next to the agent you want to upgrade.
+
The **Upgrade agent** option is grayed out when an upgrade is unavailable, or
the {kib} version is lower than the agent version.

. To upgrade multiple agents, bulk select the agents and click
**Upgrade agents**.
+
[role="screenshot"]
image::images/fleet-agents.png[Upgrade menu for bulk upgrade in {fleet}]

[discrete]
[[upgrade-standalone]]
== Upgrade standalone agents

To upgrade a standalone agent running on an edge node:

. Make sure the `elastic-agent` service is running.
. From the directory where {agent} is installed, run the `upgrade` command to
upgrade to a new version. Not sure where the agent is
installed? See <<installation-layout>>.
+
For example, on macOS, to upgrade the agent from version 7.10.0 to 7.10.1, you
would run:
+
[source,shell]
----
cd /Library/Elastic/Agent/
sudo elastic-agent upgrade 7.10.1 
----

For more command-line options, see the help for the
<<elastic-agent-upgrade-command,`upgrade`>> command.

// Add Javascript and CSS for tabbed panels
include::{tab-widgets}/code.asciidoc[]
